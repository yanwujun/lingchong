# 成就/背包/商店功能测试指南

## 🧪 测试目的

验证v0.4.0 bug修复后，成就、背包、商店三个窗口是否可以正常打开和使用。

---

## ✅ 测试前准备

### 1. 确认代码已更新
- ✅ `main.py` 已添加窗口初始化代码
- ✅ `src/sound_manager.py` 已修复初始化问题

### 2. 重启应用
如果程序已在运行，请：
1. 右键桌面宠物 → 退出
2. 或：右键系统托盘图标 → 退出
3. 重新运行 `python main.py`

---

## 📋 测试步骤

### 测试1：成就窗口

**步骤**:
1. 右键点击桌面宠物
2. 点击菜单：🐾 宠物 → 🏆 成就

**预期结果**:
- ✅ 成就窗口正常打开
- ✅ 显示成就列表
- ✅ 显示已解锁和未解锁成就
- ✅ 显示进度信息

**检查项**:
- [ ] 窗口标题显示"成就"
- [ ] 成就分类正确（任务/等级/番茄钟/互动）
- [ ] 已解锁成就有✅标记
- [ ] 未解锁成就显示进度
- [ ] 窗口可以正常关闭

---

### 测试2：背包窗口

**步骤**:
1. 右键点击桌面宠物
2. 点击菜单：🐾 宠物 → 🎒 背包

**预期结果**:
- ✅ 背包窗口正常打开
- ✅ 显示道具列表
- ✅ 显示道具数量
- ✅ 可以使用道具

**检查项**:
- [ ] 窗口标题显示"背包"
- [ ] 道具按类别显示（食物/药品/玩具/装备）
- [ ] 每个道具显示图标、名称、数量
- [ ] 点击"使用"按钮有反应
- [ ] 数量为0的道具显示为灰色
- [ ] 窗口可以正常关闭

**额外测试**:
- [ ] 使用食物道具，饥饿度+20
- [ ] 使用能量药水，能量+50
- [ ] 使用后道具数量-1

---

### 测试3：商店窗口

**步骤**:
1. 右键点击桌面宠物
2. 点击菜单：🐾 宠物 → 🛒 商店

**预期结果**:
- ✅ 商店窗口正常打开
- ✅ 显示商品列表
- ✅ 显示当前积分
- ✅ 可以购买商品

**检查项**:
- [ ] 窗口标题显示"宠物商店"
- [ ] 顶部显示当前积分
- [ ] 商品分类显示（道具/宠物）
- [ ] 每个商品显示价格
- [ ] 点击"购买"按钮有反应
- [ ] 积分不足时无法购买
- [ ] 窗口可以正常关闭

**额外测试**:
- [ ] 购买一个道具，积分减少，背包中出现
- [ ] 购买一只宠物，积分减少，宠物列表中出现

---

## 🐛 如果测试失败

### 问题1：窗口打开后立即关闭
**原因**: 可能是窗口初始化参数错误

**解决**:
1. 查看控制台错误信息
2. 检查日志文件 `logs/desktop_pet_YYYYMMDD.log`
3. 确认 `pet_id` 存在

### 问题2：窗口显示空白
**原因**: 数据加载失败

**解决**:
1. 检查数据库文件 `data/tasks.db` 是否存在
2. 确认宠物数据是否正常
3. 查看错误日志

### 问题3：点击菜单无反应
**原因**: 窗口对象仍为None

**解决**:
1. 确认代码已更新
2. 重启程序
3. 查看启动日志，确认步骤11是否成功

---

## 📊 启动日志检查

正常启动应该显示：

```
============================================================
桌面灵宠 v0.4.0 - 启动中...
============================================================

[1/15] 加载配置文件...
  [OK] 配置加载完成

[2/15] 初始化数据库...
  [OK] 数据库初始化完成
  [OK] 数据备份完成

[3/15] 初始化宠物管理器...
  [OK] 宠物管理器初始化完成

[4/15] 初始化宠物成长系统...
  [OK] 宠物成长系统初始化完成

[5/15] 创建宠物窗口...
  [OK] 宠物窗口创建完成

[6/15] 创建待办事项窗口...
  [OK] 待办窗口创建完成

[7/15] 创建设置窗口...
  [OK] 设置窗口创建完成

[8/15] 启动提醒系统...
  [OK] 提醒系统启动完成

[9/15] 创建系统托盘...
  [OK] 系统托盘创建完成

[10/15] 创建番茄钟系统...
  [OK] 番茄钟系统创建完成

[11/15] 创建成就/背包/商店窗口...   ⬅️ 关键步骤！
  [OK] 成就窗口创建完成             ⬅️ 必须显示
  [OK] 背包窗口创建完成             ⬅️ 必须显示
  [OK] 商店窗口创建完成             ⬅️ 必须显示

[12/15] 创建AI对话窗口...
  [OK] AI对话窗口创建完成

[13/15] 创建图片识别器...
  [OK] 图片识别器创建完成

[14/15] 连接组件信号...
  [OK] 信号连接完成

[15/15] 检查新手引导...
  (如果首次运行会显示引导)

============================================================
[SUCCESS] 所有组件初始化完成！
============================================================
```

**重点检查**：步骤11是否显示3个OK

---

## ✅ 测试通过标准

### 全部通过
- ✅ 成就窗口正常打开和使用
- ✅ 背包窗口正常打开和使用
- ✅ 商店窗口正常打开和使用
- ✅ 所有功能按预期工作
- ✅ 无报错和异常

### 部分通过
- ⚠️ 窗口可以打开但功能有问题
- ⚠️ 需要进一步调试

### 测试失败
- ❌ 窗口无法打开
- ❌ 点击菜单无反应
- ❌ 启动报错

---

## 📞 问题反馈

如果测试失败，请提供：
1. 错误截图
2. 控制台输出
3. 日志文件内容（`logs/desktop_pet_*.log`）
4. 操作系统版本
5. Python版本

---

## 🎉 测试结论

请在测试完成后填写：

**测试日期**: __________

**测试结果**:
- [ ] ✅ 全部通过
- [ ] ⚠️ 部分通过
- [ ] ❌ 测试失败

**成就窗口**: [ ] 通过 / [ ] 失败  
**背包窗口**: [ ] 通过 / [ ] 失败  
**商店窗口**: [ ] 通过 / [ ] 失败  

**备注**:
```
_______________________________________________
_______________________________________________
_______________________________________________
```

---

*测试指南版本: v1.0*  
*创建时间: 2025-10-11*  
*适用版本: v0.4.0+*

