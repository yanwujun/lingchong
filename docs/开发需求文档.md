# 桌面灵宠应用 - 开发需求文档

## 1. 项目概述

### 1.1 项目名称

桌面灵宠（Desktop Pet Assistant）

### 1.2 项目简介

开发一款集互动娱乐与日程管理于一体的桌面宠物应用。宠物可以在桌面上自由活动，与用户进行互动，同时具备待办事项管理和智能提醒功能，帮助用户提高工作效率。

### 1.3 目标用户

- 需要任务管理工具的上班族和学生
- 喜欢桌面宠物的用户
- 希望以轻松有趣的方式管理日程的用户

### 1.4 开发语言与平台

- **开发语言**: Python 3.8+
- **目标平台**: Windows（主要）、可扩展至 macOS 和 Linux

---

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 桌面宠物互动功能

**基础显示**

- [ ] 透明窗口显示，无边框，始终置顶
- [ ] 宠物形象支持PNG序列帧或GIF动画
- [ ] 自适应屏幕分辨率，防止宠物超出屏幕范围

**交互行为**

- [ ] **拖拽移动**: 用户可以用鼠标拖动宠物到桌面任意位置
- [ ] **点击互动**:
  - 单击：宠物做出反应（如眨眼、摇头等）
  - 双击：触发特殊动画
  - 右键：弹出功能菜单
- [ ] **跟随鼠标**: 可选功能，宠物跟随鼠标指针移动

**自主行为**

- [ ] 闲置状态：站立、呼吸等待动画
- [ ] 随机行走：在桌面上随机移动
- [ ] 休息睡觉：长时间无操作时进入睡眠状态
- [ ] 掉落效果：模拟重力，从屏幕顶部掉落到底部
- [ ] 边缘检测：在屏幕边缘时转向或停止

**动画状态**

```
- idle (待机)
- walk (行走)
- run (奔跑)
- sleep (睡觉)
- happy (开心)
- sad (伤心)
- alert (警告/提醒)
- interact (互动)
```

#### 2.1.2 待办事项管理功能

**任务管理**

- [ ] **添加任务**:

  - 任务标题（必填）
  - 任务描述（可选）
  - 截止日期和时间
  - 优先级（低、中、高）
  - 分类标签（工作、学习、生活等）
- [ ] **编辑任务**: 修改任务的所有属性
- [ ] **删除任务**: 支持单个删除和批量删除
- [ ] **任务状态**:

  - 未开始
  - 进行中
    -已完成
  - 已过期

**任务显示**

- [ ] 列表视图：显示所有待办事项
- [ ] 今日任务：突出显示今天需要完成的任务
- [ ] 过滤和排序：按日期、优先级、状态等筛选
- [ ] 搜索功能：快速查找特定任务

**提醒系统**

- [ ] **定时提醒**:

  - 任务到期前提醒（可设置提前时间：5分钟、15分钟、1小时、1天）
  - 支持重复提醒（每天、每周、每月）
- [ ] **提醒方式**:

  - 宠物播放提醒动画（跳跃、挥手等）
  - 弹出提醒窗口显示任务详情
  - 系统托盘通知
  - 提醒音效（可选）

#### 2.1.3 系统功能

**设置选项**

- [ ] 宠物形象选择（支持多个宠物皮肤）
- [ ] 动画速度调节
- [ ] 移动速度和频率设置
- [ ] 音效开关和音量控制
- [ ] 开机自启动
- [ ] 快捷键设置

**数据管理**

- [ ] 本地数据持久化（SQLite数据库）
- [ ] 数据导入/导出（JSON格式）
- [ ] 数据备份与恢复

**系统集成**

- [ ] 系统托盘图标
- [ ] 右键菜单（显示/隐藏、设置、退出等）
- [ ] Windows任务栏集成

### 2.2 扩展功能（可选）

- [ ] 宠物成长系统：根据用户任务完成情况，宠物获得经验升级
- [ ] 多宠物支持：同时显示多个宠物在桌面
- [ ] 宠物对话：随机显示气泡对话框，鼓励用户
- [ ] 番茄钟功能：集成专注工作计时器
- [ ] 天气显示：实时显示当前天气信息
- [ ] AI智能对话：集成ChatGPT等AI助手（参考Pet-GPT项目）

---

## 3. 技术方案

### 3.1 技术栈选择

| 技术类别 | 推荐方案                  | 备选方案         | 说明                        |
| -------- | ------------------------- | ---------------- | --------------------------- |
| GUI框架  | **PyQt5**           | PySide6, Tkinter | PyQt5成熟稳定，社区资源丰富 |
| 数据库   | **SQLite3**         | TinyDB, JSON文件 | 轻量级，无需额外安装        |
| 动画处理 | **QMovie (GIF)**    | PNG序列帧        | 方便制作和替换              |
| 系统托盘 | **QSystemTrayIcon** | pystray          | PyQt5内置组件               |
| 定时任务 | **QTimer**          | schedule库       | 与PyQt事件循环集成良好      |
| 配置管理 | **configparser**    | JSON, YAML       | Python标准库                |

### 3.2 项目结构

```
desktop-pet/
├── main.py                 # 程序入口
├── requirements.txt        # 依赖包列表
├── README.md              # 项目说明
├── config.ini             # 配置文件
│
├── src/
│   ├── __init__.py
│   ├── pet_window.py      # 宠物窗口类
│   ├── todo_window.py     # 待办事项窗口类
│   ├── settings_window.py # 设置窗口类
│   ├── database.py        # 数据库操作
│   ├── reminder.py        # 提醒系统
│   └── utils.py           # 工具函数
│
├── assets/
│   ├── images/            # 宠物图片资源
│   │   ├── default/       # 默认宠物
│   │   │   ├── idle.gif
│   │   │   ├── walk.gif
│   │   │   ├── sleep.gif
│   │   │   └── ...
│   │   └── skin2/         # 其他皮肤
│   ├── sounds/            # 音效文件
│   │   ├── click.wav
│   │   ├── alert.wav
│   │   └── ...
│   └── icons/             # 图标资源
│       └── tray_icon.png
│
└── tests/                 # 测试文件
    ├── test_database.py
    └── test_reminder.py
```

### 3.3 核心模块设计

#### PetWindow (宠物窗口)

```python
- 继承自 QWidget
- 无边框窗口 (Qt.FramelessWindowHint)
- 透明背景 (setAttribute(Qt.WA_TranslucentBackground))
- 窗口置顶 (Qt.WindowStaysOnTopHint)
- 鼠标事件处理（拖拽、点击）
- 动画状态机管理
- 定时器控制自主行为
```

#### TodoWindow (待办事项窗口)

```python
- 任务列表视图 (QListWidget/QTableWidget)
- 任务增删改查操作
- 与数据库交互
- 提醒时间设置
```

#### Database (数据库)

```python
表结构设计：
- tasks 表：
  - id (主键)
  - title (标题)
  - description (描述)
  - due_date (截止日期)
  - priority (优先级)
  - status (状态)
  - category (分类)
  - remind_time (提醒时间)
  - created_at (创建时间)
  - updated_at (更新时间)
```

#### ReminderSystem (提醒系统)

```python
- 定时检查待提醒任务
- 触发提醒通知
- 管理提醒队列
```

### 3.4 关键技术实现

**1. 透明窗口实现**

```python
self.setWindowFlags(
    Qt.FramelessWindowHint |      # 无边框
    Qt.WindowStaysOnTopHint |     # 置顶
    Qt.SubWindow                  # 子窗口
)
self.setAttribute(Qt.WA_TranslucentBackground)  # 透明背景
```

**2. 鼠标拖拽**

```python
def mousePressEvent(self, event):
    if event.button() == Qt.LeftButton:
        self.drag_position = event.globalPos() - self.frameGeometry().topLeft()

def mouseMoveEvent(self, event):
    if event.buttons() == Qt.LeftButton:
        self.move(event.globalPos() - self.drag_position)
```

**3. 动画播放**

```python
self.movie = QMovie("assets/images/default/idle.gif")
self.label.setMovie(self.movie)
self.movie.start()
```

---

## 4. UI设计

### 4.1 宠物形象设计

- **尺寸**: 128x128像素或256x256像素
- **格式**: GIF动画或PNG序列帧
- **风格**: 可爱、简约、像素风或卡通风
- **推荐参考**:
  - 猫咪、狗狗、兔子等常见宠物
  - 幻想生物（龙、史莱姆等）
  - 像素小人

### 4.2 待办事项界面

- **窗口大小**: 600x800像素
- **布局**:
  - 顶部：搜索栏和添加按钮
  - 中部：任务列表（可滚动）
  - 底部：统计信息（已完成/总任务数）
- **配色**: 简洁明亮，支持暗色模式

### 4.3 提醒弹窗

- **窗口大小**: 400x200像素
- **内容**:
  - 任务标题
  - 任务描述摘要
  - 截止时间
  - 操作按钮（标记完成、稍后提醒、查看详情）

---

## 5. 开发计划

### 第一阶段：基础框架搭建（1-2周）

- [X] 项目结构创建
- [X] PyQt5环境搭建
- [X] 透明窗口实现
- [X] 基础宠物显示（单个静态图片）
- [X] 鼠标拖拽功能

### 第二阶段：宠物动画与行为（1-2周）

- [ ] GIF动画加载与切换
- [ ] 多种动画状态实现
- [ ] 自主随机行为
- [ ] 边缘检测和碰撞
- [ ] 右键菜单

### 第三阶段：待办功能开发（2-3周）

- [ ] SQLite数据库设计与实现
- [ ] 待办事项窗口UI
- [ ] 任务增删改查功能
- [ ] 任务列表显示和筛选

### 第四阶段：提醒系统（1-2周）

- [ ] 定时检查机制
- [ ] 提醒触发逻辑
- [ ] 提醒弹窗实现
- [ ] 宠物提醒动画
- [ ] 音效集成

### 第五阶段：完善与优化（1-2周）

- [ ] 设置功能完善
- [ ] 系统托盘集成
- [ ] 开机自启动
- [ ] 数据导入导出
- [ ] 性能优化
- [ ] Bug修复

### 第六阶段：测试与发布（1周）

- [ ] 功能测试
- [ ] 兼容性测试
- [ ] 用户体验优化
- [ ] 打包发布（PyInstaller）
- [ ] 编写使用文档

**预计总开发时间**: 8-12周

---

## 6. 参考资源

### 6.1 开源项目参考

| 项目名称    | GitHub地址                               | 技术栈  | 特色功能           |
| ----------- | ---------------------------------------- | ------- | ------------------ |
| DyberPet    | https://github.com/ChaozhongLiu/DyberPet | PySide6 | 完整的桌面宠物框架 |
| Pet-GPT     | https://github.com/Hanzoe/Pet-GPT        | PyQt5   | 集成GPT对话功能    |
| Desktop-Pet | https://github.com/cgy2003/desktop-pet   | Python  | 基础互动功能       |

### 6.2 技术文档

- PyQt5官方文档: https://doc.qt.io/qtforpython/
- SQLite文档: https://www.sqlite.org/docs.html
- Python官方文档: https://docs.python.org/3/

### 6.3 美术资源

- OpenGameArt: https://opengameart.org/ （免费游戏素材）
- itch.io: https://itch.io/game-assets/free （免费游戏资源）
- Kenney.nl: https://kenney.nl/ （免费游戏素材库）

---

## 7. 风险评估

### 7.1 技术风险

- **跨平台兼容性**: macOS和Linux的窗口透明度和置顶可能有差异

  - **解决方案**: 优先完成Windows版本，后期适配其他平台
- **性能问题**: 动画播放和定时检查可能占用CPU

  - **解决方案**: 优化动画帧率，合理设置定时器间隔

### 7.2 用户体验风险

- **宠物遮挡工作区域**: 可能影响用户正常使用电脑

  - **解决方案**: 提供快速隐藏快捷键，智能避让活动窗口
- **提醒过于频繁**: 可能打断用户工作流

  - **解决方案**: 提供勿扰模式，智能提醒间隔

---

## 8. 成功标准

### 8.1 功能指标

- [ ] 所有核心功能完整实现
- [ ] 至少支持5种宠物动画状态
- [ ] 提醒准确率100%
- [ ] 数据操作无丢失

### 8.2 性能指标

- [ ] CPU占用率 < 2%（闲置状态）
- [ ] 内存占用 < 100MB
- [ ] 启动时间 < 3秒
- [ ] 界面响应时间 < 100ms

### 8.3 用户体验指标

- [ ] 界面友好，操作直观
- [ ] 动画流畅自然
- [ ] 无明显Bug和崩溃
- [ ] 用户反馈积极

---

## 9. 后续迭代方向

### 版本 1.0（MVP）

- 基础宠物显示和互动
- 待办事项管理
- 简单提醒功能

### 版本 2.0

- 多宠物支持
- 宠物成长系统
- 更丰富的动画和互动
- 云端数据同步

### 版本 3.0

- AI智能助手集成
- 语音交互
- 社区分享（宠物皮肤、动画等）
- 跨平台移动端支持

---

## 10. 附录

### 10.1 依赖包清单（requirements.txt）

```
PyQt5>=5.15.0
PyQt5-Qt5>=5.15.0
PyQt5-sip>=12.8.0
```

### 10.2 开发环境要求

- Python 3.8+
- Windows 10/11 (开发主平台)
- VS Code 或 PyCharm (推荐IDE)
- Git (版本控制)

### 10.3 联系方式

- 项目负责人: [待填写]
- 邮箱: [待填写]
- 项目仓库: [待填写]

---

**文档版本**: v1.0
**创建日期**: 2025-10-11
**最后更新**: 2025-10-11
