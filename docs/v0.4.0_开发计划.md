# v0.4.0 开发计划 - 完整版功能集

## 📋 版本信息
- **版本号**: v0.4.0
- **代号**: 智能成长版
- **目标完成度**: 从 98% → 99%+
- **预计代码增量**: ~5,000 行

---

## 🎯 功能列表

### 1. 番茄钟 - 完整版 🍅
**核心功能**:
- 标准番茄钟（25分钟工作/5分钟休息）
- 自定义时长设置
- 暂停/继续/重置/跳过
- 桌面悬浮小窗口
- 与任务关联
- 自动切换关联任务
- 专注模式（全屏提醒/屏蔽通知）
- 番茄钟统计报表

**技术实现**:
- `src/pomodoro_window.py` - 番茄钟主窗口
- `src/pomodoro_widget.py` - 桌面悬浮小组件
- 数据库扩展：`pomodoro_sessions` 表
- QTimer 精确计时
- 与任务表关联

---

### 2. 宠物成长系统 - 完整版 🐱
**核心功能**:
- 经验值和等级系统（完成任务/番茄钟获得经验）
- 宠物属性（饥饿度、心情、健康）
- 外观随等级变化
- 成就系统（徽章收集）
- 进化系统（达到特定等级进化）
- 装备道具系统
- 互动奖励（喂食、玩耍）
- 宠物状态自动衰减

**技术实现**:
- `src/pet_growth.py` - 成长系统管理
- `src/pet_achievements.py` - 成就系统
- `src/pet_inventory.py` - 道具背包
- 数据库扩展：
  - `pet_data` 表（等级、经验、属性）
  - `achievements` 表
  - `inventory` 表
- 定时器更新宠物状态

---

### 3. AI对话系统 - API版 🤖
**核心功能**:
- 与宠物文字对话
- 接入 OpenAI API / 其他 AI API
- 对话历史记录
- 上下文记忆（最近10条）
- 预设角色和个性
- 智能任务建议
- 情感识别和回应

**技术实现**:
- `src/ai_chat.py` - AI对话管理
- `src/chat_window.py` - 对话界面
- 使用 `openai` 或 `requests` 库
- 数据库扩展：`chat_history` 表
- 配置文件存储 API Key
- 异步请求避免阻塞UI

---

### 4. 多宠物系统 - 完整版 🐾
**核心功能**:
- 同时显示多个宠物（2-5个）
- 每个宠物独立属性和等级
- 可切换主宠物
- 宠物位置记忆
- 宠物交互动画
- 宠物收藏系统
- 宠物商店（用积分兑换）
- 宠物重命名

**技术实现**:
- `src/pet_manager.py` - 多宠物管理器
- `src/pet_shop.py` - 宠物商店
- 修改 `pet_window.py` 支持多实例
- 数据库扩展：`pets` 表（多宠物数据）
- 配置文件保存宠物位置

---

### 5. 图片识别生成待办 - AI视觉 📸
**核心功能**:
- 支持拖放图片到宠物
- 图片格式支持（PNG/JPG/JPEG/BMP）
- 使用 OpenAI Vision API 识别图片内容
- 自动生成待办任务
- 支持批量识别
- 识别历史记录

**技术实现**:
- 修改 `pet_window.py` 启用拖放接收
- `src/image_recognizer.py` - 图片识别模块
- 使用 OpenAI Vision API 或其他图像识别 API
- base64 编码图片上传
- 智能解析识别结果生成任务
- 数据库扩展：`image_tasks` 表

---

## 🗂️ 文件结构

### 新建文件（10个）
```
src/pomodoro_window.py      - 番茄钟主窗口
src/pomodoro_widget.py       - 番茄钟桌面小组件
src/pet_growth.py            - 宠物成长系统
src/pet_achievements.py      - 成就系统
src/pet_inventory.py         - 道具背包
src/ai_chat.py               - AI对话管理
src/chat_window.py           - 对话窗口
src/pet_manager.py           - 多宠物管理器
src/pet_shop.py              - 宠物商店
src/image_recognizer.py      - 图片识别模块
```

### 修改文件（8个）
```
src/database.py              - 扩展数据库表
src/pet_window.py            - 支持多实例、拖放
main.py                      - 集成新功能
src/settings_window.py       - 添加新设置选项
src/todo_window.py           - 集成番茄钟
src/tray_icon.py             - 添加新菜单项
requirements.txt             - 添加新依赖
config.ini                   - 添加新配置项
```

---

## 📦 依赖更新

```txt
# AI 相关
openai>=1.0.0              # OpenAI API
requests>=2.31.0           # HTTP 请求
Pillow>=10.0.0            # 图片处理（已有）

# 可选：本地AI
# transformers>=4.30.0     # 如果使用本地模型
```

---

## 🔧 数据库扩展

### 新增表（8个）

```sql
-- 番茄钟会话记录
CREATE TABLE pomodoro_sessions (
    id INTEGER PRIMARY KEY,
    task_id INTEGER,
    start_time TEXT,
    end_time TEXT,
    duration INTEGER,
    completed BOOLEAN,
    type TEXT  -- 'work' or 'break'
);

-- 宠物数据
CREATE TABLE pets (
    id INTEGER PRIMARY KEY,
    name TEXT,
    type TEXT,
    level INTEGER DEFAULT 1,
    experience INTEGER DEFAULT 0,
    hunger INTEGER DEFAULT 100,
    happiness INTEGER DEFAULT 100,
    health INTEGER DEFAULT 100,
    is_active BOOLEAN DEFAULT 1,
    position_x INTEGER,
    position_y INTEGER,
    created_at TEXT
);

-- 宠物成就
CREATE TABLE achievements (
    id INTEGER PRIMARY KEY,
    pet_id INTEGER,
    achievement_name TEXT,
    unlocked_at TEXT
);

-- 宠物道具
CREATE TABLE inventory (
    id INTEGER PRIMARY KEY,
    pet_id INTEGER,
    item_name TEXT,
    item_type TEXT,
    quantity INTEGER DEFAULT 1
);

-- AI对话历史
CREATE TABLE chat_history (
    id INTEGER PRIMARY KEY,
    pet_id INTEGER,
    role TEXT,  -- 'user' or 'assistant'
    message TEXT,
    timestamp TEXT
);

-- 图片识别任务
CREATE TABLE image_tasks (
    id INTEGER PRIMARY KEY,
    image_path TEXT,
    recognition_result TEXT,
    task_id INTEGER,
    created_at TEXT
);
```

---

## 🎨 UI设计要点

### 番茄钟
- 桌面悬浮小窗口（圆形/方形可选）
- 主窗口详细设置和统计
- 进度环显示剩余时间
- 开始/暂停/重置按钮

### 宠物成长
- 宠物状态栏（经验条、等级）
- 属性面板（饥饿、心情、健康）
- 成就墙界面
- 道具背包界面

### AI对话
- 聊天气泡界面
- 输入框和发送按钮
- 历史记录滚动
- 加载状态提示

### 多宠物
- 宠物列表侧边栏
- 宠物切换按钮
- 宠物商店界面
- 宠物卡片展示

---

## 🚀 实施步骤

### 阶段1：基础架构（1-2天）
1. 扩展数据库结构
2. 创建基础模块框架
3. 配置文件更新

### 阶段2：核心功能（3-4天）
4. 实现番茄钟系统
5. 实现宠物成长系统
6. 实现AI对话系统

### 阶段3：高级功能（2-3天）
7. 实现多宠物系统
8. 实现图片识别功能

### 阶段4：集成与优化（1-2天）
9. 功能集成测试
10. UI优化和bug修复
11. 文档更新

---

## 📊 预期成果

### 功能指标
- **新增功能**: 5个主要功能
- **新增代码**: ~5,000 行
- **数据库表**: +6 个
- **UI窗口**: +5 个

### 用户体验提升
- **游戏化**: ⬆️ 200%（成长、成就、道具）
- **智能化**: ⬆️ 300%（AI对话、图片识别）
- **效率工具**: ⬆️ 150%（番茄钟、专注模式）

### 完成度
- v0.3.0: 98%
- **v0.4.0: 99%+** 🎯

---

## ⚠️ 注意事项

### API Key 管理
- 需要用户提供 OpenAI API Key
- 配置文件加密存储
- 提供测试模式（模拟响应）

### 性能考虑
- 多宠物时的资源占用
- AI请求的异步处理
- 图片识别的文件大小限制

### 用户隐私
- API Key 本地存储
- 对话历史可选清除
- 图片仅临时上传

---

## 📚 配套文档

需要更新/创建的文档：
- ✅ `v0.4.0_开发计划.md` - 本文件
- ⏳ `docs/番茄钟使用指南.md`
- ⏳ `docs/宠物成长系统说明.md`
- ⏳ `docs/AI对话配置指南.md`
- ⏳ `docs/API配置说明.md`
- ⏳ `docs/CHANGELOG.md` - 更新

---

**开始时间**: 待定  
**预计完成**: 7-10 天  
**开发优先级**: 高  
**风险等级**: 中（API依赖）

