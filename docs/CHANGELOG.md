# 版本更新日志

## v0.4.0 (2025-10-11) - 智能成长版 🚀

### 🎉 重大更新
本次更新带来5大完整版核心功能，代码增量约4,000行，是迄今为止最大的功能性更新！

### ✨ 新增功能

#### 🍅 番茄钟系统 - 完整版
- **计时器功能** - 25分钟工作/5分钟短休息/15分钟长休息
- **自定义时长** - 可自由设置工作和休息时间
- **任务关联** - 番茄钟可关联具体任务
- **桌面小组件** - 悬浮计时器，可拖动位置
- **专注模式** - 屏蔽通知，专心工作
- **统计报表** - 查看番茄钟完成情况和工作时长
- **自动切换** - 工作/休息自动切换（可选）
- **经验奖励** - 完成番茄钟获得3点经验

#### 🐱 宠物成长系统 - 完整版
- **经验值系统** - 完成任务+5经验，番茄钟+3经验
- **等级系统** - 每100经验升1级，无上限
- **4维属性** - 饱食度、心情、健康、能量
- **进化系统** - 10级/25级/50级三次进化
- **属性衰减** - 每小时自动衰减5点
- **互动系统** - 喂食、玩耍、休息恢复属性
- **升级奖励** - 升级获得道具奖励
- **进化奖励** - 进化时全属性恢复

#### 🏆 成就系统 - 完整版
- **30+成就** - 覆盖等级、任务、番茄钟、互动等
- **成就墙** - 精美的成就展示界面
- **自动解锁** - 达成条件自动检测并解锁
- **成就分类** - 按类型分组显示
- **解锁提示** - 解锁时的动画和通知

#### 🎒 道具系统 - 完整版
- **14种道具** - 食物、玩具、药品、装备等
- **背包管理** - 查看和使用道具
- **道具效果** - 恢复属性、增加心情等
- **装备系统** - 可穿戴装备（项圈、帽子、围巾）
- **奖励机制** - 完成任务/番茄钟获得道具
- **数量叠加** - 相同道具自动合并

#### 🤖 AI对话系统 - API版
- **OpenAI集成** - 支持GPT-3.5/GPT-4模型
- **智能对话** - 与宠物聊天，获得建议
- **3种性格** - 活力四射、沉稳智慧、默认性格
- **上下文记忆** - 保留最近10条对话
- **对话历史** - 所有对话保存到数据库
- **任务建议** - AI分析任务列表给出建议
- **异步处理** - 不阻塞UI，流畅体验

#### 🐾 多宠物系统 - 完整版
- **多宠物管理** - 最多拥有5只宠物
- **宠物切换** - 切换激活的主宠物
- **位置记忆** - 每只宠物独立保存位置
- **独立属性** - 每只宠物有独立的等级和属性
- **宠物收藏** - 解锁和收集不同类型宠物
- **宠物商店** - 使用积分购买新宠物
- **积分系统** - 完成任务+10积分，番茄钟+5积分

#### 📸 图片识别生成待办 - AI视觉
- **拖放识别** - 将图片拖到宠物即可识别
- **Vision API** - OpenAI Vision API智能识别
- **自动生成任务** - 从图片内容生成待办事项
- **批量添加** - 一次识别多个任务
- **识别历史** - 保存识别记录到数据库
- **格式支持** - JPG/PNG/GIF/BMP/WEBP

### 🔧 优化改进
- 🔧 **数据库扩展** - 新增6个表支持新功能
- 🔧 **信号系统** - 完善的信号和回调机制
- 🔧 **异步处理** - AI请求使用线程避免阻塞
- 🔧 **奖励机制** - 完善的经验和道具奖励体系
- 🔧 **窗口管理** - 统一的窗口显示和隐藏机制

### 📦 依赖更新
- ➕ 新增 `openai>=1.0.0` - OpenAI API支持
- ➕ 新增 `requests>=2.31.0` - HTTP请求支持

### 🗂️ 数据库变更
**新增表**：
- `pomodoro_sessions` - 番茄钟会话记录
- `pets` - 宠物数据（支持多宠物）
- `achievements` - 成就解锁记录
- `inventory` - 道具背包
- `chat_history` - AI对话历史
- `image_tasks` - 图片识别记录

**扩展字段**：
- `tasks.completed_date` - 任务完成时间
- `tasks.pomodoro_count` - 关联的番茄钟数

### 📊 代码统计
- **新增文件**: 11个核心模块
- **修改文件**: 5个主要文件
- **新增代码**: ~4,000行
- **数据库表**: +6个
- **UI窗口**: +7个

### 🎯 完成度提升
- v0.3.0: 98%
- **v0.4.0: 99%** 🎉

### 🐛 已知限制
- AI功能需要OpenAI API Key（需用户自行申请）
- 图片识别需要网络连接
- Vision API调用有费用（按使用量计费）
- 音效文件仍使用占位资源

### 📚 使用指南
详见：
- `docs/v0.4.0_使用指南.md` - 完整使用说明
- `docs/API配置指南.md` - API Key配置教程
- `docs/v0.4.0_完成报告.md` - 详细开发报告

### 🔜 下一步计划（v0.5.0）
- 📱 任务导出/导入
- 🌐 多语言支持
- 📅 日历视图
- 🔔 系统通知
- 🎮 更多宠物皮肤

---

## v0.3.0 (2025-10-11) - 功能增强版

### 🎉 新增功能
- ✨ **音效系统** - 全新的音效反馈系统
  - 点击音效 - 点击宠物和按钮时播放
  - 提醒音效 - 任务提醒时播放
  - 完成音效 - 完成任务时播放
  - 实时音量调节 - 在设置中滑动调节音量
- 🎨 **暗色主题** - 支持浅色/暗色主题切换
  - 在设置窗口切换主题
  - 所有窗口自动同步主题
  - 精心设计的暗色配色方案
- 📊 **数据统计窗口** - 全面的任务数据分析
  - 任务概览 - 总任务、已完成、待完成、已过期
  - 完成率显示 - 直观的进度条
  - 时间段统计 - 今日、本周、本月完成数
  - 优先级分布 - 高中低优先级任务统计
  - 分类统计 - 按分类查看任务分布
- 🏷️ **任务标签系统** - 灵活的标签管理
  - 创建自定义标签
  - 为任务添加多个标签
  - 标签按钮快速选择
  - 标签筛选和管理
- 🎓 **新手引导** - 友好的首次使用引导
  - 4页精美引导界面
  - 功能介绍和快捷键说明
  - 可选的示例任务创建
  - "不再显示"选项

### 🔧 优化改进
- 🔧 **主题同步机制** - 设置窗口切换主题时，所有窗口自动同步
- 🔧 **音效管理** - 统一的音效管理器，支持启用/禁用和音量控制
- 🔧 **数据库扩展** - 新增 tags 和 task_tags 表支持标签功能
- 🔧 **TaskDialog 增强** - 集成标签选择，支持创建新标签
- 🔧 **统计窗口** - 使用 PyQt5 原生组件，轻量高效

### 🐛 Bug修复
- 无新增Bug修复（本次更新专注于新功能）

### 📚 文档更新
- 📄 更新《src/__init__.py》- 版本号更新为 0.3.0
- 📄 更新《main.py》- 集成新手引导和主题同步
- 📄 更新《docs/CHANGELOG.md》- 本次更新日志

### 📦 依赖更新
- ➕ 新增 `PyQt5-Multimedia>=5.15.0` - 音效支持

### 🎯 下一步计划
- 📱 任务导出/导入功能
- 🌐 多语言支持
- 🎮 更多宠物皮肤
- 📅 日历视图
- 🔔 系统通知集成

---

## v0.2.0 Beta (2025-10-11) - 优化版

### 🎉 新增功能
- ✨ **编辑任务功能** - 双击任务或按 Enter 键编辑，支持完整的数据回填
- ✨ **实时搜索功能** - 在搜索框输入关键词，即时显示匹配结果
- ✨ **快捷键支持** - 新增5个常用快捷键，提升操作效率
  - `Ctrl+N` - 新建任务
  - `Ctrl+F` - 聚焦搜索框
  - `Ctrl+W` - 关闭窗口
  - `Delete` - 删除选中任务
  - `Enter` - 编辑选中任务
- ✨ **自动数据备份** - 启动时自动备份数据库，保留7天历史
- ✨ **平滑动画过渡** - 宠物移动使用2秒平滑动画，更加自然
- ✨ **边界保护** - 拖动宠物时自动限制在屏幕内，不会丢失

### 🔧 优化改进
- 🔧 **资源路径兼容** - 添加 `get_resource_path()` 函数，兼容开发和打包环境
- 🔧 **控制台编码修复** - 修复 Windows GBK 编码导致的 UnicodeEncodeError
- 🔧 **TaskDialog 数据回填** - 编辑任务时正确显示日期和分类
- 🔧 **数据库备份管理** - 自动清理7天前的旧备份文件

### 🐛 Bug修复
- 🐛 修复控制台输出特殊字符导致的编码错误
- 🐛 修复编辑任务功能未实现的问题
- 🐛 修复搜索功能未连接的问题
- 🐛 修复宠物可被拖到屏幕外的问题
- 🐛 修复打包后资源文件找不到的问题

### 📚 文档更新
- 📄 新增《优化建议清单.md》- 44个优化点详细说明
- 📄 新增《优化完成报告.md》- 优化对比和测试指南
- 📄 新增《项目最终总结.md》- 项目成果总结
- 📄 更新《README.md》- 添加v0.2.0新特性说明
- 📄 新增《CHANGELOG.md》- 本文件

---

## v0.1.0 MVP (2025-10-11) - 初始版本

### ✨ 初始功能
- 🎮 桌面宠物窗口（透明、可拖拽）
- 📝 待办事项管理（添加、查看、删除）
- ⏰ 提醒系统（定时检查、弹窗提醒）
- 🔧 系统托盘集成
- ⚙️ 设置窗口
- 💾 SQLite 数据库

### 📚 文档
- 📄 开发需求文档（60+页）
- 📄 快速开始指南（35+页）
- 📄 MVP使用说明（30+页）
- 📄 打包说明、设计需求等

### 🎨 资源
- 🖼️ 5个占位图片（idle, walk, happy, alert, sleep）
- 🔖 系统托盘图标
- ⚙️ 配置文件

### ⚠️ 已知问题
- 编辑任务功能未实现
- 搜索功能未实现
- 宠物移动不流畅
- 控制台编码错误
- 中文路径打包问题

---

## 版本规划

### v0.3.0 (计划中) - 增强版
- [ ] 音效系统
- [ ] 日志系统
- [ ] 暗色主题
- [ ] 新手引导
- [ ] 数据统计图表
- [ ] 任务标签系统

### v0.4.0 (计划中) - 特色版
- [ ] 番茄钟功能
- [ ] 宠物成长系统
- [ ] 多皮肤支持
- [ ] AI 对话功能

### v1.0.0 (计划中) - 正式版
- [ ] 所有核心功能完善
- [ ] 性能全面优化
- [ ] 跨平台支持
- [ ] 完整的帮助文档
- [ ] 专业的美术资源

---

## 升级指南

### 从 v0.1.0 升级到 v0.2.0

1. **备份数据**（可选，程序会自动备份）
   ```bash
   copy data\tasks.db data\tasks.db.backup
   ```

2. **更新代码**
   - 替换所有 Python 文件
   - 保留 `data/tasks.db` 数据库文件
   - 保留个人修改的 `config.ini`

3. **运行新版本**
   ```bash
   python main.py
   ```

4. **验证功能**
   - 测试编辑任务（双击任务）
   - 测试搜索功能（输入关键词）
   - 测试快捷键（Ctrl+N 等）
   - 观察宠物移动（应该是平滑的）
   - 检查 backups 目录（应有备份文件）

---

## 贡献者

感谢所有为本项目做出贡献的开发者！

---

## 许可证

MIT License - 详见 LICENSE 文件

---

## 相关链接

- GitHub: [项目地址]
- 文档: 查看项目根目录下的各种 .md 文件
- 问题反馈: [Issues链接]

---

**最后更新**：2025-10-11

