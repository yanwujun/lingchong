# æ¡Œé¢çµå®  - æ‰“åŒ…æˆ EXE æŒ‡å—

## ğŸ“¦ æ‰“åŒ…æ–¹æ³•

### æ–¹æ³•1ï¼šPyInstallerï¼ˆæ¨èï¼‰

#### æ­¥éª¤1ï¼šå®‰è£… PyInstaller
```bash
pip install pyinstaller
```

#### æ­¥éª¤2ï¼šæ‰“åŒ…

**é€‰é¡¹Aï¼šå•æ–‡ä»¶æ‰“åŒ…ï¼ˆæ¨èï¼Œæ–¹ä¾¿åˆ†å‘ï¼‰**
```bash
pyinstaller --onefile --windowed --icon=assets/icons/tray_icon.ico --name="æ¡Œé¢çµå® " main.py
```

**é€‰é¡¹Bï¼šæ–‡ä»¶å¤¹æ‰“åŒ…ï¼ˆå¯åŠ¨æ›´å¿«ï¼‰**
```bash
pyinstaller --windowed --icon=assets/icons/tray_icon.ico --name="æ¡Œé¢çµå® " main.py
```

#### æ­¥éª¤3ï¼šå¤åˆ¶èµ„æºæ–‡ä»¶

æ‰“åŒ…å®Œæˆåï¼Œéœ€è¦å°†ä»¥ä¸‹æ–‡ä»¶å¤¹å¤åˆ¶åˆ° `dist` ç›®å½•ï¼š
```
dist/
â”œâ”€â”€ æ¡Œé¢çµå® .exe
â”œâ”€â”€ assets/          # å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹
â”œâ”€â”€ config.ini       # å¤åˆ¶é…ç½®æ–‡ä»¶
â””â”€â”€ data/            # åˆ›å»ºæ•°æ®ç›®å½•
```

---

## ğŸ”§ è¯¦ç»†é…ç½®

### ä½¿ç”¨ spec æ–‡ä»¶ï¼ˆæ¨èï¼‰

åˆ›å»ºæ‰“åŒ…é…ç½®æ–‡ä»¶ï¼Œæ›´çµæ´»æ§åˆ¶æ‰“åŒ…è¿‡ç¨‹ã€‚

**æ­¥éª¤1ï¼šç”Ÿæˆ spec æ–‡ä»¶**
```bash
pyi-makespec --onefile --windowed --icon=assets/icons/tray_icon.ico --name="æ¡Œé¢çµå® " main.py
```

**æ­¥éª¤2ï¼šç¼–è¾‘ spec æ–‡ä»¶**

ç”Ÿæˆçš„ `æ¡Œé¢çµå® .spec` æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```python
# -*- mode: python ; coding: utf-8 -*-

block_cipher = None

# æ·»åŠ èµ„æºæ–‡ä»¶
added_files = [
    ('assets', 'assets'),           # åŒ…å«æ‰€æœ‰èµ„æºæ–‡ä»¶
    ('config.ini', '.'),            # é…ç½®æ–‡ä»¶
    ('src', 'src'),                 # æºä»£ç ï¼ˆå¦‚æœéœ€è¦ï¼‰
]

a = Analysis(
    ['main.py'],
    pathex=[],
    binaries=[],
    datas=added_files,              # æ·»åŠ æ•°æ®æ–‡ä»¶
    hiddenimports=[],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=[],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False,
)

pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)

exe = EXE(
    pyz,
    a.scripts,
    a.binaries,
    a.zipfiles,
    a.datas,
    [],
    name='æ¡Œé¢çµå® ',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    upx_exclude=[],
    runtime_tmpdir=None,
    console=False,                  # ä¸æ˜¾ç¤ºæ§åˆ¶å°çª—å£
    disable_windowed_traceback=False,
    argv_emulation=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
    icon='assets/icons/tray_icon.ico',  # åº”ç”¨å›¾æ ‡
)
```

**æ­¥éª¤3ï¼šä½¿ç”¨ spec æ–‡ä»¶æ‰“åŒ…**
```bash
pyinstaller æ¡Œé¢çµå® .spec
```

---

## ğŸ“ åˆ›å»ºæ‰“åŒ…è„šæœ¬

ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä¼šåˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–æ‰“åŒ…è„šæœ¬ã€‚

### Windows æ‰¹å¤„ç†è„šæœ¬ (build.bat)

```batch
@echo off
echo ========================================
echo æ¡Œé¢çµå®  - è‡ªåŠ¨æ‰“åŒ…è„šæœ¬
echo ========================================

echo.
echo [1/5] æ¸…ç†æ—§çš„æ‰“åŒ…æ–‡ä»¶...
if exist build rmdir /s /q build
if exist dist rmdir /s /q dist
if exist "æ¡Œé¢çµå® .spec" del "æ¡Œé¢çµå® .spec"

echo.
echo [2/5] æ£€æŸ¥ PyInstaller...
pip show pyinstaller >nul 2>&1
if errorlevel 1 (
    echo PyInstaller æœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…...
    pip install pyinstaller
)

echo.
echo [3/5] å¼€å§‹æ‰“åŒ…...
pyinstaller --onefile --windowed --icon=assets/icons/tray_icon.ico --name="æ¡Œé¢çµå® " main.py

echo.
echo [4/5] å¤åˆ¶èµ„æºæ–‡ä»¶...
xcopy /E /I /Y assets dist\assets
copy config.ini dist\
mkdir dist\data 2>nul

echo.
echo [5/5] æ¸…ç†ä¸´æ—¶æ–‡ä»¶...
rmdir /s /q build
del "æ¡Œé¢çµå® .spec"

echo.
echo ========================================
echo æ‰“åŒ…å®Œæˆï¼
echo ========================================
echo.
echo å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®: dist\æ¡Œé¢çµå® .exe
echo.
echo è¿è¡Œå‰è¯·ç¡®ä¿ dist ç›®å½•åŒ…å«ï¼š
echo   - æ¡Œé¢çµå® .exe
echo   - assets æ–‡ä»¶å¤¹
echo   - config.ini
echo   - data æ–‡ä»¶å¤¹
echo.
pause
```

### Python æ‰“åŒ…è„šæœ¬ (build.py)

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
è‡ªåŠ¨æ‰“åŒ…è„šæœ¬
"""

import os
import shutil
import subprocess
import sys

def clean_build():
    """æ¸…ç†æ—§çš„æ‰“åŒ…æ–‡ä»¶"""
    print("\n[1/5] æ¸…ç†æ—§çš„æ‰“åŒ…æ–‡ä»¶...")
    dirs_to_remove = ['build', 'dist', '__pycache__']
    files_to_remove = ['æ¡Œé¢çµå® .spec']
    
    for dir_name in dirs_to_remove:
        if os.path.exists(dir_name):
            shutil.rmtree(dir_name)
            print(f"  å·²åˆ é™¤: {dir_name}")
    
    for file_name in files_to_remove:
        if os.path.exists(file_name):
            os.remove(file_name)
            print(f"  å·²åˆ é™¤: {file_name}")

def check_pyinstaller():
    """æ£€æŸ¥å¹¶å®‰è£… PyInstaller"""
    print("\n[2/5] æ£€æŸ¥ PyInstaller...")
    try:
        import PyInstaller
        print("  PyInstaller å·²å®‰è£…")
    except ImportError:
        print("  PyInstaller æœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…...")
        subprocess.run([sys.executable, '-m', 'pip', 'install', 'pyinstaller'])

def build_exe():
    """æ‰“åŒ…æˆ exe"""
    print("\n[3/5] å¼€å§‹æ‰“åŒ…...")
    
    cmd = [
        'pyinstaller',
        '--onefile',
        '--windowed',
        '--icon=assets/icons/tray_icon.ico',
        '--name=æ¡Œé¢çµå® ',
        'main.py'
    ]
    
    try:
        subprocess.run(cmd, check=True)
        print("  æ‰“åŒ…æˆåŠŸï¼")
    except subprocess.CalledProcessError:
        print("  æ‰“åŒ…å¤±è´¥ï¼")
        sys.exit(1)

def copy_resources():
    """å¤åˆ¶èµ„æºæ–‡ä»¶"""
    print("\n[4/5] å¤åˆ¶èµ„æºæ–‡ä»¶...")
    
    # å¤åˆ¶ assets æ–‡ä»¶å¤¹
    if os.path.exists('assets'):
        shutil.copytree('assets', 'dist/assets', dirs_exist_ok=True)
        print("  å·²å¤åˆ¶: assets/")
    
    # å¤åˆ¶é…ç½®æ–‡ä»¶
    if os.path.exists('config.ini'):
        shutil.copy('config.ini', 'dist/')
        print("  å·²å¤åˆ¶: config.ini")
    
    # åˆ›å»º data ç›®å½•
    os.makedirs('dist/data', exist_ok=True)
    print("  å·²åˆ›å»º: data/")

def cleanup():
    """æ¸…ç†ä¸´æ—¶æ–‡ä»¶"""
    print("\n[5/5] æ¸…ç†ä¸´æ—¶æ–‡ä»¶...")
    
    if os.path.exists('build'):
        shutil.rmtree('build')
        print("  å·²åˆ é™¤: build/")
    
    if os.path.exists('æ¡Œé¢çµå® .spec'):
        os.remove('æ¡Œé¢çµå® .spec')
        print("  å·²åˆ é™¤: æ¡Œé¢çµå® .spec")

def main():
    """ä¸»å‡½æ•°"""
    print("=" * 60)
    print("æ¡Œé¢çµå®  - è‡ªåŠ¨æ‰“åŒ…è„šæœ¬")
    print("=" * 60)
    
    try:
        clean_build()
        check_pyinstaller()
        build_exe()
        copy_resources()
        cleanup()
        
        print("\n" + "=" * 60)
        print("æ‰“åŒ…å®Œæˆï¼")
        print("=" * 60)
        print("\nå¯æ‰§è¡Œæ–‡ä»¶ä½ç½®: dist/æ¡Œé¢çµå® .exe")
        print("\nè¿è¡Œå‰è¯·ç¡®ä¿ dist ç›®å½•åŒ…å«ï¼š")
        print("  - æ¡Œé¢çµå® .exe")
        print("  - assets/ æ–‡ä»¶å¤¹")
        print("  - config.ini")
        print("  - data/ æ–‡ä»¶å¤¹")
        print()
        
    except Exception as e:
        print(f"\n[é”™è¯¯] æ‰“åŒ…å¤±è´¥: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šæ‰“åŒ…åæ— æ³•æ‰¾åˆ°èµ„æºæ–‡ä»¶

**åŸå› **ï¼šèµ„æºæ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**ï¼šä¿®æ”¹ä»£ç ä¸­çš„èµ„æºè·¯å¾„

```python
# åœ¨ main.py æˆ–ç›¸å…³æ–‡ä»¶å¼€å¤´æ·»åŠ 
import sys
import os

def get_resource_path(relative_path):
    """è·å–èµ„æºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„"""
    if hasattr(sys, '_MEIPASS'):
        # PyInstaller åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶å¤¹
        return os.path.join(sys._MEIPASS, relative_path)
    return os.path.join(os.path.abspath("."), relative_path)

# ä½¿ç”¨æ–¹æ³•
icon_path = get_resource_path("assets/icons/tray_icon.png")
```

### é—®é¢˜2ï¼šæ‰“åŒ…æ–‡ä»¶å¤ªå¤§

**è§£å†³æ–¹æ³•**ï¼š

1. ä½¿ç”¨ UPX å‹ç¼©ï¼ˆéœ€è¦ä¸‹è½½ UPXï¼‰
```bash
pyinstaller --onefile --windowed --upx-dir=./upx main.py
```

2. æ’é™¤ä¸éœ€è¦çš„åº“
```bash
pyinstaller --onefile --windowed --exclude-module=matplotlib main.py
```

### é—®é¢˜3ï¼šæ‰“åŒ…åè¿è¡ŒæŠ¥é”™

**è§£å†³æ–¹æ³•**ï¼š

1. å…ˆç”¨é `--windowed` æ¨¡å¼æ‰“åŒ…ï¼ŒæŸ¥çœ‹æ§åˆ¶å°é”™è¯¯
```bash
pyinstaller --onefile main.py
```

2. æ·»åŠ éšè—å¯¼å…¥
```bash
pyinstaller --onefile --hidden-import=PyQt5 main.py
```

### é—®é¢˜4ï¼šä¸­æ–‡è·¯å¾„é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š

ç¡®ä¿ä»£ç ä½¿ç”¨ UTF-8 ç¼–ç ï¼Œåœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š
```python
# -*- coding: utf-8 -*-
```

---

## ğŸ“¦ å‘å¸ƒå‡†å¤‡

### åˆ›å»ºå‘å¸ƒåŒ…

```
æ¡Œé¢çµå® _v1.0/
â”œâ”€â”€ æ¡Œé¢çµå® .exe           # å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ assets/                # èµ„æºæ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ sounds/
â”‚   â””â”€â”€ icons/
â”œâ”€â”€ config.ini             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ data/                  # æ•°æ®ç›®å½•ï¼ˆç©ºï¼‰
â”œâ”€â”€ README.txt             # ä½¿ç”¨è¯´æ˜
â””â”€â”€ LICENSE.txt            # è®¸å¯è¯
```

### README.txt ç¤ºä¾‹

```
æ¡Œé¢çµå®  v1.0
===============================

ã€å®‰è£…è¯´æ˜ã€‘
1. æ— éœ€å®‰è£…ï¼Œç›´æ¥è¿è¡Œ "æ¡Œé¢çµå® .exe"
2. é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“

ã€ä½¿ç”¨è¯´æ˜ã€‘
1. æ‹–åŠ¨å® ç‰© - å·¦é”®æ‹–åŠ¨
2. æ‰“å¼€èœå• - å³é”®ç‚¹å‡»å® ç‰©æˆ–æ‰˜ç›˜å›¾æ ‡
3. æ·»åŠ ä»»åŠ¡ - å³é”® â†’ å¾…åŠäº‹é¡¹ â†’ æ·»åŠ 
4. è®¾ç½®é€‰é¡¹ - å³é”® â†’ è®¾ç½®

ã€ç³»ç»Ÿè¦æ±‚ã€‘
- Windows 7/10/11
- æ— éœ€å®‰è£… Python

ã€æ³¨æ„äº‹é¡¹ã€‘
- è¯·å‹¿åˆ é™¤ assets æ–‡ä»¶å¤¹
- config.ini ä¸ºé…ç½®æ–‡ä»¶
- data æ–‡ä»¶å¤¹å­˜å‚¨æ•°æ®

ã€è”ç³»æ–¹å¼ã€‘
- é—®é¢˜åé¦ˆï¼š[æ‚¨çš„é‚®ç®±]
- é¡¹ç›®åœ°å€ï¼š[GitHubé“¾æ¥]

ç‰ˆæƒæ‰€æœ‰ Â© 2025
```

---

## ğŸ æ‰“åŒ…ä¼˜åŒ–

### å‡å°æ–‡ä»¶ä½“ç§¯

1. **ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ**
```bash
python -m venv pack_env
pack_env\Scripts\activate
pip install PyQt5 Pillow pyinstaller
pyinstaller ...
```

2. **æ’é™¤æµ‹è¯•æ–‡ä»¶**
```python
# åœ¨ .spec æ–‡ä»¶ä¸­
a = Analysis(
    ...
    excludes=['tests', 'pytest', 'unittest'],
    ...
)
```

3. **å‹ç¼©å¯æ‰§è¡Œæ–‡ä»¶**
- ä½¿ç”¨ UPX å·¥å…·
- ä½¿ç”¨ 7-Zip ç­‰å·¥å…·æ‰“åŒ…åˆ†å‘

### æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯

åˆ›å»º `version.txt`:
```
# UTF-8
VSVersionInfo(
  ffi=FixedFileInfo(
    filevers=(1, 0, 0, 0),
    prodvers=(1, 0, 0, 0),
    mask=0x3f,
    flags=0x0,
    OS=0x40004,
    fileType=0x1,
    subtype=0x0,
    date=(0, 0)
  ),
  kids=[
    StringFileInfo(
      [
      StringTable(
        u'080404b0',
        [StringStruct(u'CompanyName', u'æ¡Œé¢çµå® '),
        StringStruct(u'FileDescription', u'æ¡Œé¢çµå® åº”ç”¨'),
        StringStruct(u'FileVersion', u'1.0.0'),
        StringStruct(u'ProductName', u'æ¡Œé¢çµå® '),
        StringStruct(u'ProductVersion', u'1.0.0')])
      ]), 
    VarFileInfo([VarStruct(u'Translation', [2052, 1200])])
  ]
)
```

ä½¿ç”¨ï¼š
```bash
pyinstaller --onefile --version-file=version.txt main.py
```

---

## âœ… æ‰“åŒ…æ£€æŸ¥æ¸…å•

æ‰“åŒ…å‰æ£€æŸ¥ï¼š
- [ ] æ‰€æœ‰ä¾èµ–å·²å®‰è£…
- [ ] èµ„æºæ–‡ä»¶å·²å‡†å¤‡
- [ ] é…ç½®æ–‡ä»¶å·²æ›´æ–°
- [ ] ä»£ç å·²æµ‹è¯•æ— è¯¯
- [ ] å›¾æ ‡æ–‡ä»¶å­˜åœ¨

æ‰“åŒ…åæ£€æŸ¥ï¼š
- [ ] exe æ–‡ä»¶èƒ½æ­£å¸¸è¿è¡Œ
- [ ] èµ„æºæ–‡ä»¶åŠ è½½æ­£å¸¸
- [ ] æ•°æ®åº“åˆ›å»ºæˆåŠŸ
- [ ] ç³»ç»Ÿæ‰˜ç›˜æ˜¾ç¤ºæ­£å¸¸
- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡

å‘å¸ƒå‰æ£€æŸ¥ï¼š
- [ ] åˆ›å»ºå‘å¸ƒåŒ…æ–‡ä»¶å¤¹
- [ ] ç¼–å†™ README.txt
- [ ] æ·»åŠ  LICENSE.txt
- [ ] å‹ç¼©æˆ .zip
- [ ] æµ‹è¯•è§£å‹åè¿è¡Œ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

æœ€ç®€å•çš„æ‰“åŒ…æ–¹æ³•ï¼š

```bash
# 1. å®‰è£… PyInstaller
pip install pyinstaller

# 2. è¿è¡Œæ‰“åŒ…è„šæœ¬
python build.py

# 3. æµ‹è¯•
cd dist
æ¡Œé¢çµå® .exe
```

---

ç¥æ‰“åŒ…é¡ºåˆ©ï¼ğŸ‰

