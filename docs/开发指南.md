# æ¡Œé¢çµå®  - å¼€å‘æŒ‡å—

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-13

---

## 1. ç¯å¢ƒæ­å»º

### 1.1 ç¯å¢ƒè¦æ±‚
- Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- Windows 10/11ï¼ˆæ¨èï¼‰
- pip åŒ…ç®¡ç†å™¨

### 1.2 å®‰è£…æ­¥éª¤

```bash
# 1. æ£€æŸ¥Pythonç‰ˆæœ¬
python --version

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 4. å®‰è£…ä¾èµ–åŒ…
pip install -r requirements.txt

# 5. éªŒè¯å®‰è£…
python main.py
```

---

## 2. é¡¹ç›®ç»“æ„

### 2.1 ç›®å½•ç»“æ„

```
æ¡Œé¢çµå® /
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt        # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ config.ini             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜
â”‚
â”œâ”€â”€ src/                   # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ pet_window.py      # å® ç‰©çª—å£
â”‚   â”œâ”€â”€ todo_window.py     # å¾…åŠçª—å£
â”‚   â”œâ”€â”€ settings_window.py # è®¾ç½®çª—å£
â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ reminder.py        # æé†’ç³»ç»Ÿ
â”‚   â”œâ”€â”€ tray_icon.py       # ç³»ç»Ÿæ‰˜ç›˜
â”‚   â”œâ”€â”€ utils.py           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ logger.py          # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ sound_manager.py   # éŸ³æ•ˆç®¡ç†
â”‚   â”œâ”€â”€ themes.py          # ä¸»é¢˜æ ·å¼
â”‚   â”œâ”€â”€ statistics_window.py # ç»Ÿè®¡çª—å£
â”‚   â”œâ”€â”€ tutorial.py        # æ–°æ‰‹å¼•å¯¼
â”‚   â”œâ”€â”€ pomodoro_core.py   # ç•ªèŒ„é’Ÿæ ¸å¿ƒ
â”‚   â”œâ”€â”€ pomodoro_window.py # ç•ªèŒ„é’Ÿçª—å£
â”‚   â”œâ”€â”€ pomodoro_widget.py # ç•ªèŒ„é’Ÿç»„ä»¶
â”‚   â”œâ”€â”€ pet_growth.py      # å® ç‰©æˆé•¿ç³»ç»Ÿ
â”‚   â”œâ”€â”€ pet_achievements.py # æˆå°±ç³»ç»Ÿ
â”‚   â”œâ”€â”€ pet_inventory.py   # é“å…·ç³»ç»Ÿ
â”‚   â”œâ”€â”€ ai_chat.py         # AIå¯¹è¯æ ¸å¿ƒ
â”‚   â”œâ”€â”€ chat_window.py     # å¯¹è¯çª—å£
â”‚   â”œâ”€â”€ pet_manager.py     # å¤šå® ç‰©ç®¡ç†
â”‚   â”œâ”€â”€ pet_shop.py        # å® ç‰©å•†åº—
â”‚   â””â”€â”€ image_recognizer.py # å›¾ç‰‡è¯†åˆ«
â”‚
â”œâ”€â”€ assets/                # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ images/           # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ sounds/           # éŸ³æ•ˆæ–‡ä»¶
â”‚   â””â”€â”€ icons/            # å›¾æ ‡èµ„æº
â”‚
â”œâ”€â”€ data/                 # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ tasks.db          # SQLiteæ•°æ®åº“
â”‚
â”œâ”€â”€ config/               # é…ç½®ç›®å½•
â”‚   â””â”€â”€ api_keys.json     # APIå¯†é’¥
â”‚
â”œâ”€â”€ backups/              # å¤‡ä»½ç›®å½•
â”œâ”€â”€ logs/                 # æ—¥å¿—ç›®å½•
â””â”€â”€ docs/                 # æ–‡æ¡£ç›®å½•
```

### 2.2 æ¨¡å—è¯´æ˜

**æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼ˆv0.1.0ï¼‰**ï¼š
- `pet_window.py` - å® ç‰©çª—å£ï¼Œé€æ˜ã€å¯æ‹–åŠ¨
- `todo_window.py` - å¾…åŠäº‹é¡¹ç®¡ç†çª—å£
- `database.py` - æ•°æ®åº“æ“ä½œï¼Œ15ä¸ªè¡¨
- `reminder.py` - æé†’ç³»ç»Ÿ

**å¢å¼ºåŠŸèƒ½æ¨¡å—ï¼ˆv0.2.0-v0.3.0ï¼‰**ï¼š
- `sound_manager.py` - éŸ³æ•ˆç®¡ç†
- `themes.py` - ä¸»é¢˜æ ·å¼
- `statistics_window.py` - æ•°æ®ç»Ÿè®¡
- `tutorial.py` - æ–°æ‰‹å¼•å¯¼

**æ™ºèƒ½åŠŸèƒ½æ¨¡å—ï¼ˆv0.4.0ï¼‰**ï¼š
- `pomodoro_core.py` - ç•ªèŒ„é’Ÿæ ¸å¿ƒé€»è¾‘
- `pet_growth.py` - å® ç‰©æˆé•¿ç³»ç»Ÿ
- `pet_achievements.py` - æˆå°±ç³»ç»Ÿ
- `pet_inventory.py` - é“å…·ç³»ç»Ÿ
- `ai_chat.py` - AIå¯¹è¯æ ¸å¿ƒ
- `image_recognizer.py` - å›¾ç‰‡è¯†åˆ«
- `pet_manager.py` - å¤šå® ç‰©ç®¡ç†

### 2.3 æ•°æ®åº“ç»“æ„

**æ ¸å¿ƒè¡¨ï¼ˆ15ä¸ªï¼‰**ï¼š
1. `tasks` - ä»»åŠ¡è¡¨
2. `config` - é…ç½®è¡¨
3. `tags` - æ ‡ç­¾è¡¨
4. `task_tags` - ä»»åŠ¡æ ‡ç­¾å…³è”è¡¨
5. `pomodoro_sessions` - ç•ªèŒ„é’Ÿä¼šè¯è¡¨
6. `pets` - å® ç‰©è¡¨
7. `achievements` - æˆå°±è¡¨
8. `inventory` - èƒŒåŒ…è¡¨
9. `chat_history` - å¯¹è¯å†å²è¡¨
10. `image_tasks` - å›¾ç‰‡è¯†åˆ«è®°å½•è¡¨

---

## 3. å¼€å‘æµç¨‹

### 3.1 ç†è§£é¡¹ç›®ç»“æ„ï¼ˆ1-2å°æ—¶ï¼‰

1. **é˜…è¯»æ–‡æ¡£**
   - é˜…è¯» `éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦.md`
   - é˜…è¯» `æŠ€æœ¯å®ç°æ–‡æ¡£.md`
   - é˜…è¯» `README.md`

2. **ç†Ÿæ‚‰ä»£ç **
   - ä» `main.py` å¼€å§‹
   - æŸ¥çœ‹ `src/pet_window.py` äº†è§£çª—å£å®ç°
   - æŸ¥çœ‹ `src/database.py` äº†è§£æ•°æ®æ“ä½œ

3. **è¿è¡Œæµ‹è¯•**
   ```bash
   python main.py
   ```

### 3.2 å¼€å‘æ–°åŠŸèƒ½

1. **åˆ›å»ºæ¨¡å—**
   - åœ¨ `src/` ç›®å½•åˆ›å»ºæ–°æ–‡ä»¶
   - ç»§æ‰¿ç›¸åº”çš„åŸºç±»ï¼ˆå¦‚ `QWidget`ï¼‰

2. **é›†æˆåˆ°ä¸»ç¨‹åº**
   - åœ¨ `main.py` ä¸­åˆå§‹åŒ–
   - è¿æ¥ä¿¡å·å’Œæ§½
   - æ·»åŠ åˆ°èœå•

3. **æµ‹è¯•åŠŸèƒ½**
   - è¿è¡Œç¨‹åºæµ‹è¯•
   - æ£€æŸ¥æ—¥å¿—è¾“å‡º
   - éªŒè¯æ•°æ®æŒä¹…åŒ–

### 3.3 è°ƒè¯•æŠ€å·§

```python
# æ·»åŠ è°ƒè¯•è¾“å‡º
print(f"[DEBUG] å½“å‰ä½ç½®: {self.pos()}")

# ä½¿ç”¨PyQtçš„è°ƒè¯•å·¥å…·
from PyQt5.QtCore import qDebug
qDebug("è°ƒè¯•ä¿¡æ¯")

# æ£€æŸ¥èµ„æºæ–‡ä»¶
import os
animation_path = "assets/images/default/idle.gif"
print(f"æ–‡ä»¶å­˜åœ¨: {os.path.exists(animation_path)}")
```

---

## 4. æŠ€æœ¯è¦ç‚¹

### 4.1 é€æ˜çª—å£å®ç°

```python
self.setWindowFlags(
    Qt.FramelessWindowHint |      # æ— è¾¹æ¡†
    Qt.WindowStaysOnTopHint |     # ç½®é¡¶
    Qt.SubWindow                  # å­çª—å£
)
self.setAttribute(Qt.WA_TranslucentBackground)  # é€æ˜èƒŒæ™¯
```

### 4.2 é¼ æ ‡æ‹–æ‹½

```python
def mousePressEvent(self, event):
    if event.button() == Qt.LeftButton:
        self.drag_position = event.globalPos() - self.frameGeometry().topLeft()

def mouseMoveEvent(self, event):
    if event.buttons() == Qt.LeftButton:
        self.move(event.globalPos() - self.drag_position)
```

### 4.3 åŠ¨ç”»æ’­æ”¾

```python
self.movie = QMovie("assets/images/default/idle.gif")
self.label.setMovie(self.movie)
self.movie.start()
```

### 4.4 èµ„æºè·¯å¾„å¤„ç†

```python
import sys
import os

def get_resource_path(relative_path):
    """è·å–èµ„æºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„"""
    if hasattr(sys, '_MEIPASS'):
        # PyInstaller åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶å¤¹
        return os.path.join(sys._MEIPASS, relative_path)
    return os.path.join(os.path.abspath("."), relative_path)
```

---

## 5. ä¾èµ–åŒ…

### 5.1 æ ¸å¿ƒä¾èµ–

```
PyQt5>=5.15.0
PyQt5-Qt5>=5.15.0
PyQt5-sip>=12.8.0
PyQt5-Multimedia>=5.15.0
```

### 5.2 AIåŠŸèƒ½ä¾èµ–ï¼ˆv0.4.0ï¼‰

```
openai>=1.0.0
requests>=2.31.0
Pillow>=10.0.0
```

---

## 6. å¸¸è§é—®é¢˜

### Q1: åŠ¨ç”»ä¸æ˜¾ç¤ºæ€ä¹ˆåŠï¼Ÿ
- ç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®
- ç¡®è®¤æ–‡ä»¶æ ¼å¼ï¼ˆGIFï¼‰
- ç¡®è®¤æ–‡ä»¶æ²¡æœ‰æŸå
- æ£€æŸ¥æ ‡ç­¾å¤§å°æ˜¯å¦è¶³å¤Ÿ

### Q2: çª—å£ä¸é€æ˜æ€ä¹ˆåŠï¼Ÿ
```python
self.setAttribute(Qt.WA_TranslucentBackground)
self.setWindowFlags(Qt.FramelessWindowHint | Qt.WindowStaysOnTopHint)
self.setStyleSheet("background: transparent;")
```

### Q3: æ‰“åŒ…åèµ„æºæ–‡ä»¶æ‰¾ä¸åˆ°ï¼Ÿ
ä½¿ç”¨ `get_resource_path()` å‡½æ•°å¤„ç†èµ„æºè·¯å¾„ã€‚

---

## 7. å¼€å‘è§„èŒƒ

### 7.1 ä»£ç é£æ ¼
- ä½¿ç”¨ PEP 8 ä»£ç è§„èŒƒ
- å‡½æ•°å’Œç±»æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸²
- å˜é‡å‘½åæ¸…æ™°æœ‰æ„ä¹‰

### 7.2 æ¨¡å—åŒ–è®¾è®¡
- æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€
- ä½¿ç”¨ä¿¡å·å’Œæ§½è¿›è¡Œé€šä¿¡
- é¿å…å¾ªç¯ä¾èµ–

### 7.3 é”™è¯¯å¤„ç†
- ä½¿ç”¨ try-except æ•è·å¼‚å¸¸
- è®°å½•é”™è¯¯æ—¥å¿—
- æä¾›å‹å¥½çš„é”™è¯¯æç¤º

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0*  
*æœ€åæ›´æ–°: 2025-01-13*  
*ç»´æŠ¤è€…: Desktop Pet Development Team*

---

## 8. è‡ªå®šä¹‰è§’è‰²åŒ…

1. **å‡†å¤‡ç´ æ**  
   - å‚è€ƒ `external/ShimejiEE-cross-platform/ext-resources/img` ä¸­çš„ç¤ºä¾‹ï¼Œå°† PNG å¸§æ•´ç†ä¸ºå•ç‹¬æ–‡ä»¶å¤¹ï¼ˆå¦‚ `my-pack/shime1.png` ç­‰ï¼‰ã€‚  
   - å¦‚éœ€å¿«é€Ÿå¯¼å…¥ ShimejiEE èµ„äº§ï¼Œå¯æ‰§è¡Œï¼š  
     ```bash
     python scripts/import_shimeji_assets.py ^
       --source external/ShimejiEE-cross-platform/ext-resources/img ^
       --output assets/pets
     ```

2. **pack.json ç»“æ„**  
   - æ¯ä¸ªè§’è‰²åŒ…ä½äº `assets/pets/<pack_id>/`ï¼ŒåŒ…å« `frames/` ä»¥åŠ `pack.json`ã€‚  
   - `pack.json` æè¿°å¸§å°ºå¯¸ã€å¯ç”¨ç‰¹æ€§å’ŒåŠ¨ç”»ã€‚ä¾‹å¦‚ï¼š  
     ```json
     {
       "id": "dark-shime",
       "name": "æš—è‰² Shimeji",
       "frame_size": [128, 128],
       "features": ["multi-instance", "climb_wall", "climb_ceiling", "fall"],
       "animations": {
         "walk": {
           "loop": true,
           "frames": [
             {"path": "frames/shime1.png", "duration": 80},
             {"path": "frames/shime2.png", "duration": 80}
           ]
         }
       },
       "default_animation": "idle"
     }
     ```

3. **åœ¨åº”ç”¨å†…åˆ‡æ¢è§’è‰²åŒ…**  
   - é€šè¿‡ç³»ç»Ÿæ‰˜ç›˜èœå•â€œğŸ¾ å® ç‰©å®ä¾‹ â†’ ğŸ¨ åˆ‡æ¢è§’è‰²åŒ…â€é€‰æ‹©ç›®æ ‡å® ç‰©ä¸åŒ…ã€‚  
   - åˆ‡æ¢åï¼Œå® ç‰©ä¼šå³æ—¶é‡æ–°åŠ è½½å¸§åŠ¨ç”»ï¼›é…ç½®å†™å…¥æ•°æ®åº“ï¼Œé‡å¯åä»ç„¶ç”Ÿæ•ˆã€‚

4. **è‡ªå®šä¹‰è§’è‰²åŒ…å»ºè®®**  
   - å›¾ç‰‡å»ºè®®ä¿æŒé€æ˜èƒŒæ™¯ï¼Œå°ºå¯¸å¯ä»¥å¤§äºåŸºç¡€ 128pxï¼Œç¨‹åºä¼šæŒ‰é…ç½®ç¼©æ”¾ã€‚  
   - å¦‚æœæŸäº›åŠ¨ä½œæœªæä¾›å¸§ï¼Œåˆ é™¤å¯¹åº”åŠ¨ç”»å³å¯ï¼Œå® ç‰©ä¼šè‡ªåŠ¨å›é€€åˆ°é»˜è®¤åŠ¨ç”»ã€‚

